求排列的排名: 先对每个数都求出它后面有几个数比它小(可以用树状数组预处理), 记为$c_i$, 则排列的排名就是

$$ \sum_{i = 1} ^ n c_i (n - i)! $$

已知排名构造排列: 从前到后先分别求出$c_i$, 有了$c_i$之后再用一个平衡树(需要维护排名)倒序处理即可.